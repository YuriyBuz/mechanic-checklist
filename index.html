<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Інтерактивний чек-лист: Механік зміни</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base Variables for Theming */
        :root {
            --bg-color: #f8fafc; /* slate-50 */
            --card-bg-color: #ffffff;
            --text-color: #1e293b; /* slate-800 */
            --text-muted-color: #64748b; /* slate-500 */
            --item-bg-color: #f1f5f9; /* slate-100 */
            --item-hover-bg-color: #e2e8f0; /* slate-200 */
            --border-color: #e2e8f0;
            --active-btn-bg: #10b981; /* emerald-500 */
            --active-btn-text: #ffffff;
            --error-btn-bg: #ef4444; /* red-500 */
        }

        .dark {
            --bg-color: #1e293b; /* slate-800 */
            --card-bg-color: #334155; /* slate-700 */
            --text-color: #f1f5f9; /* slate-100 */
            --text-muted-color: #94a3b8; /* slate-400 */
            --item-bg-color: #475569; /* slate-600 */
            --item-hover-bg-color: #64748b; /* slate-500 */
            --border-color: #475569;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 6rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .card { background-color: var(--card-bg-color); }
        .text-muted { color: var(--text-muted-color); }

        .checklist-item {
            background-color: var(--item-bg-color);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .checklist-item.completed {
            background-color: var(--item-hover-bg-color);
            border-left: 4px solid var(--active-btn-bg);
        }
        
        .nav-button.active { background-color: #059669; color: white; border-color: #059669; }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.6); z-index: 1000; }
        .modal-content { z-index: 1001; }
        
        /* Custom Input Styles */
        .option-btn {
            background-color: transparent;
            border: 1px solid var(--text-muted-color);
            color: var(--text-muted-color);
            transition: all 0.2s;
        }
        .option-btn:hover { background-color: rgba(0,0,0,0.05); }
        .option-btn.selected-good {
            background-color: var(--active-btn-bg);
            color: white;
            border-color: var(--active-btn-bg);
        }
        .option-btn.selected-bad {
            background-color: var(--error-btn-bg);
            color: white;
            border-color: var(--error-btn-bg);
        }
        
        input[type="number"], input[type="text"] {
            background-color: var(--card-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        /* Photo Styles */
        .photo-btn.has-photo {
            color: #10b981; /* green */
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.1);
        }
        .photo-thumbnail {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            display: none;
        }
        .photo-thumbnail.show {
            display: block;
        }

        /* Network Status Indicator - UPDATED: Under icons */
        .network-status {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.8);
            padding: 2px 8px;
            border-radius: 12px;
            backdrop-filter: blur(2px);
            margin-top: 0.5rem;
            margin-left: auto; /* Push to right */
            width: fit-content;
        }
        .dark .network-status { background: rgba(0,0,0,0.3); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .status-dot.online { background: #10b981; }
        .status-dot.offline { background: #ef4444; }
        .status-dot.syncing { background: #f59e0b; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        @media print {
            body { padding-bottom: 0; }
            header, .mb-6.bg-white, nav, #footerStatus, .modal-overlay, .actions, button, a[href^="tel"], .controls-area, .photo-controls, #mainSubmitSection, .network-status {
                display: none !important;
            }
            .print-value { display: block !important; }
            main, section, .card {
                display: block !important;
                box-shadow: none !important;
                border: none !important;
            }
        }
        .print-value { display: none; font-weight: bold; }
        
        /* Table in modal - UPDATED for better contrast */
        .preview-table td, .preview-table th {
            text-align: left;
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
            color: #1e293b; /* Force dark text for readability on white bg */
        }
        /* No dark mode override for table to keep it "paper-like" */
    </style>
</head>
<body class="bg-slate-50 font-sans">

    <div class="container mx-auto max-w-3xl p-4 sm:p-6 lg:p-8 relative">
        
        <header class="relative text-center mb-6">
             <div class="absolute top-0 left-0 text-center">
                <a href="#" onclick="location.reload()" class="inline-block p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Оновити сторінку">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                </a>
                <div id="current-date" class="text-muted text-xs mt-1"></div>
            </div>

            <!-- Header Right Icons & Status -->
            <div class="absolute top-0 right-0 flex flex-col items-end">
                <div class="flex space-x-2">
                     <button id="printBtn" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Друк / Зберегти в PDF">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
                    </button>
                     <button id="themeToggle" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Темна/Світла тема">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                    </button>
                    <button id="contactsBtnHeader" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Контакти">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M12 14a4 4 0 100-8 4 4 0 000 8z" /></svg>
                    </button>
                </div>
                
                <div class="network-status shadow-sm border border-gray-200 dark:border-gray-700 cursor-pointer" id="networkStatusBtn" title="Натисніть для синхронізації">
                    <span class="status-dot online" id="statusDot"></span>
                    <span id="statusText">Онлайн</span>
                </div>
            </div>
        </header>

        <img src="https://foodline-production.com/wp-content/uploads/2021/10/3752781497_3752781497.webp" alt="Foodline Production Logo" class="w-24 h-auto mx-auto mb-4 rounded-lg">

        <div class="text-center mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold">Чек-лист Механіка зміни</h1>
            <p class="text-muted">Контрольні точки для організації роботи</p>
        </div>

        <div class="mb-6 card p-4 rounded-xl shadow-sm">
            <label for="employeeSelect" class="block text-sm font-bold mb-2">Прізвище та ім'я Механіка:</label>
            <select id="employeeSelect" class="block w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 card text-muted">
                <option value="">Оберіть зі списку</option>
            </select>
        </div>

        <nav class="flex justify-center items-center mb-6 card p-2 rounded-xl shadow-sm">
            <button id="startShiftBtn" class="nav-button active w-1/2 text-center py-2 px-4 rounded-lg font-semibold border border-gray-300 dark:border-slate-600 focus:outline-none transition-all duration-300">Початок зміни</button>
            <button id="endShiftBtn" class="nav-button w-1/2 text-center py-2 px-4 rounded-lg font-semibold border border-gray-300 dark:border-slate-600 focus:outline-none transition-all duration-300">Кінець зміни</button>
        </nav>

        <main id="checklistContainer">
            <!-- Content will be generated by JS -->
        </main>
        
        <section id="contactsSection" class="hidden">
             <div class="card p-4 sm:p-6 rounded-2xl shadow-md">
                <h2 class="text-xl sm:text-2xl font-bold mb-4">Контакти для оперативного зв'язку</h2>
                <div class="space-y-4 contact-list">
                    <!-- Contacts generated by JS -->
                </div>
             </div>
        </section>
    </div>

    <div id="footerStatus" class="fixed bottom-0 left-0 right-0 card p-4 shadow-lg flex items-center justify-between z-40">
        <div class="w-full">
            <div class="w-full bg-gray-200 dark:bg-slate-600 rounded-full h-2.5 mb-2">
                <div id="currentProgressBar" class="progress-bar-fill bg-emerald-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p id="currentStatus" class="text-sm text-muted text-right">Залишилось завдань: 0</p>
        </div>
    </div>

    <div id="completionModal" class="fixed inset-0 hidden items-center justify-center modal-overlay p-4"></div>
    <div id="commentModal" class="fixed inset-0 hidden items-center justify-center modal-overlay"></div>

    <!-- Hidden canvas for image compression -->
    <canvas id="compressionCanvas" class="hidden"></canvas>

    <script>
        // --- CONFIGURATION ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzzNXfjZQj5VspFz1MCEM22Rg1kDs9mtxVScRQ33jzO0xHFF3lpAGWPsZSrNxNsHNX-4A/exec'; 
        
        // Checklist Structure Configuration
        const checklistConfig = [
            {
                id: 'compressor',
                title: '1. Компресорне приміщення',
                items: [
                    { id: '1-1', text: 'Температура компресорів', type: 'dual_input', labels: ['№1', '№2'], unit: '°C', visibleOn: 'all' },
                    { id: '1-2', text: 'Проконтролювати відсутність помилок на пультах керування компресорів.', type: 'binary', options: ['Немає', 'Є'], visibleOn: 'all' },
                    
                    // Start Specific
                    { id: '1-3', text: 'Вимкнути систему нічного обігріву приміщення.', type: 'binary', options: ['Вимкнено', 'Увімкнено'], visibleOn: 'start' },
                    { id: '1-4', text: 'Відкрити заслінки припливно-витяжної вентиляції.', type: 'binary', options: ['Відкрито', 'Закрито'], visibleOn: 'start' },
                    { id: '1-6', text: 'Увімкнути подачу тиску на ресивери.', type: 'binary', options: ['Увімкнено', 'Вимкнено'], visibleOn: 'start' },
                    
                    // End Specific
                    { id: '1-3-end', text: 'Увімкнути систему нічного обігріву (якщо потрібно).', type: 'binary', options: ['Увімкнено', 'Не потр.'], visibleOn: 'end' },
                    { id: '1-4-end', text: 'Закрити заслінки вентиляції.', type: 'binary', options: ['Закрито', 'Відкрито'], visibleOn: 'end' },
                    { id: '1-6-end', text: 'Вимкнути подачу тиску (закрити крани).', type: 'binary', options: ['Закрито', 'Відкрито'], visibleOn: 'end' },

                    { id: '1-5', text: 'Оглянути осушувач повітря на справність.', type: 'binary', options: ['Справний', 'Несправний'], visibleOn: 'all' }
                ]
            },
            {
                id: 'wells',
                title: '2. Свердловини №1 (ближня) та №2 (дальня)',
                items: [
                    { id: '2-1', text: 'Перевірити табло клапана тиску на наявність помилок.', type: 'binary', options: ['Немає', 'Є'], visibleOn: 'all' },
                    { id: '2-2', text: 'Здійснити візуальний огляд цілісності трубопроводів.', type: 'binary', options: ['Цілі', 'Пошкоджені'], visibleOn: 'all' },
                    { id: '2-3', text: 'Проконтролювати роботу насосів (відсутність стороннього шуму та вібрації).', type: 'binary', options: ['Норма', 'Шум/Вібрація'], visibleOn: 'all' },
                    { id: '2-4', text: 'Зафіксувати додаткові зауваження щодо стану об’єктів у журналі.', type: 'binary', options: ['Записано', 'Без змін'], visibleOn: 'all' }
                ]
            },
            {
                id: 'generator',
                title: '3. Генератор',
                items: [
                    { id: '6-1', text: 'Провести зовнішній візуальний огляд агрегату.', type: 'binary', options: ['Оглянуто', 'Зауваження'], visibleOn: 'all' },
                    { id: '6-2', text: 'Переконатися у відсутності сторонніх шумів під час роботи.', type: 'binary', options: ['Норма', 'Шум'], visibleOn: 'all' },
                    { id: '6-3', text: 'Перевірити рівень вібрації корпусу та вузлів.', type: 'binary', options: ['Норма', 'Вібрація'], visibleOn: 'all' },
                    { id: '6-4', text: 'Зняти поточні показники з інформаційного табло.', type: 'input', unit: '', visibleOn: 'all' }
                ]
            },
            {
                id: 'boiler',
                title: '4. Котельні №1 та №2',
                items: [
                    { id: '3-1', text: 'Зняти показники манометрів тиску пари.', type: 'input', unit: 'бар', visibleOn: 'all' },
                    { id: '3-2', text: 'Проконтролювати коректність роботи водяних насосів.', type: 'binary', options: ['Коректно', 'Збій'], visibleOn: 'all' },
                    { id: '3-3', text: 'Перевірити рівень води в ємності забору води.', type: 'binary', options: ['Норма', 'Низький'], visibleOn: 'all' },
                    { id: '3-4', text: 'Здійснити візуальний контроль рівнемірів та оглядового скла (вода, пара).', type: 'binary', options: ['Видно', 'Не видно'], visibleOn: 'all' },
                    { id: '3-5', text: 'Оглянути стан димососа та вентиляторів топки.', type: 'binary', options: ['Справні', 'Несправні'], visibleOn: 'all' },
                    { id: '3-6', text: 'Перевірити герметичність паропроводів, засувок та вентилів.', type: 'binary', options: ['Герметично', 'Пропуск'], visibleOn: 'all' },
                    { id: '3-7', text: 'Провести огляд щита керування котельнею.', type: 'binary', options: ['Оглянуто', 'Зауваження'], visibleOn: 'all' }
                ]
            },
            {
                id: 'fridge',
                title: '5. Холодильний контейнер',
                items: [
                    { id: '7-1', text: 'Зіставити поточну температуру всередині з установленим режимом.', type: 'input', unit: '°C', visibleOn: 'all' },
                    { id: '7-2', text: 'Перевірити контролер на наявність аварійних кодів або помилок.', type: 'binary', options: ['Немає', 'Є'], visibleOn: 'all' },
                    { id: '7-3', text: 'Оглянути ущільнювачі дверей на цілісність та відсутність обмерзання.', type: 'binary', options: ['Цілі', 'Пошкоджені'], visibleOn: 'all' },
                    { id: '7-4', text: 'Проконтролювати роботу вентиляторів (відсутність звуків/вібрацій).', type: 'binary', options: ['Норма', 'Шум'], visibleOn: 'all' },
                    { id: '7-5', text: 'Перевірити щільність закриття клапанів та прохідність дренажної системи.', type: 'binary', options: ['Норма', 'Забито'], visibleOn: 'all' }
                ]
            },
            {
                id: 'hvo',
                title: '6. ХВО (Хімічне водоочищення)',
                items: [
                    { id: '4-1', text: 'Тиск води (вхід/вихід)', type: 'dual_input', labels: ['Вхід', 'Вихід'], unit: 'бар', visibleOn: 'all' },
                    { id: '4-2', text: 'Проконтролювати робочий тиск повітря.', type: 'input', unit: 'бар', visibleOn: 'all' },
                    { id: '4-3', text: 'Переконатися у відсутності помилок під час процесу регенерації.', type: 'binary', options: ['Немає', 'Є'], visibleOn: 'all' },
                    { id: '4-4', text: 'Перевірити рівень солі та води в ємностях.', type: 'binary', options: ['Норма', 'Низький'], visibleOn: 'all' },
                    { id: '4-5', text: 'Оглянути всі вузли системи (цілісність).', type: 'binary', options: ['Цілі', 'Пошкоджені'], visibleOn: 'all' },
                    { id: '4-6', text: 'Перевірити щит керування (час, автомати, напруга).', type: 'binary', options: ['Норма', 'Збій'], visibleOn: 'all' },
                    { id: '4-7', text: 'Проконтролювати роботу підвищувальних насосів.', type: 'binary', options: ['Норма', 'Збій'], visibleOn: 'all' }
                ]
            },
            {
                id: 'production',
                title: '7. Виробничі зони',
                items: [
                    { id: '5-1', text: 'Перевірити справність робочого освітлення.', type: 'binary', options: ['Справне', 'Несправне'], visibleOn: 'all' },
                    { id: '5-2', text: 'Оглянути стан трубопроводів у слюсарній майстерні.', type: 'binary', options: ['Норма', 'Збій'], visibleOn: 'all' },
                    
                    // Start
                    { id: '5-3', text: 'Увімкнути загальну систему вентиляції.', type: 'binary', options: ['Увімкнено', 'Вимкнено'], visibleOn: 'start' },
                    // End
                    { id: '5-3-end', text: 'Вимкнути загальну вентиляцію (якщо зміна закінчена).', type: 'binary', options: ['Вимкнено', 'Працює'], visibleOn: 'end' },

                    { id: '5-4', text: 'Виміряти та зафіксувати показники напруги в мережі (за потреби).', type: 'input', unit: 'В', visibleOn: 'all' }
                ]
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // Populate Modals HTML - Forced light theme for preview
            document.getElementById('completionModal').innerHTML = `
                <div class="card p-6 rounded-2xl shadow-xl w-full max-w-lg text-center modal-content max-h-[90vh] overflow-y-auto">
                    <h3 id="modalMessage" class="text-xl font-bold mb-4">Попередній перегляд звіту</h3>
                    <div id="previewContent" class="text-left mb-6 text-sm border rounded p-2 bg-white text-gray-900 max-h-60 overflow-y-auto">
                        <!-- Preview Table generated here -->
                    </div>
                    <div class="flex flex-col gap-3">
                        <button id="submitReportBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-colors">Підтвердити та Відправити</button>
                        <button id="closeModalBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Повернутися до редагування</button>
                    </div>
                    <div id="submitStatus" class="mt-2 text-sm hidden font-bold"></div>
                </div>`;

            document.getElementById('commentModal').innerHTML = `
                <div class="card p-6 rounded-2xl shadow-xl max-w-sm w-full text-center modal-content">
                    <h3 class="text-xl font-bold mb-4">Ваш коментар</h3>
                    <textarea id="commentTextarea" class="w-full p-2 border rounded-lg card text-muted" rows="4"></textarea>
                    <div class="mt-4 flex justify-end space-x-2">
                         <button id="cancelCommentBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Скасувати</button>
                         <button id="saveCommentBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Зберегти</button>
                    </div>
                </div>`;

            const contactsData = [
                { name: 'Диндар Анастасія', phone: '066-313-31-75', tel: '+380663133175' },
                { name: 'Бузницький Юрій', phone: '050-446-79-73', tel: '+380504467973' },
                { name: 'Галагін Евгеній', phone: '066-217-48-25', tel: '+380662174825' },
                { name: 'Матвеєва Олена', phone: '050-334-02-67', tel: '+380503340267' },
            ];
            
            // Generate Contacts
            const contactsContainer = document.querySelector('.contact-list');
            contactsData.forEach(contact => {
                const contactEl = document.createElement('div');
                contactEl.className = 'bg-gray-50 dark:bg-slate-600 p-4 rounded-lg flex items-center justify-between';
                contactEl.innerHTML = `
                    <div>
                        <p class="font-bold">${contact.name}</p>
                        <p class="text-muted">${contact.phone}</p>
                    </div>
                    <a href="tel:${contact.tel}" class="bg-green-500 hover:bg-green-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    </a>`;
                contactsContainer.appendChild(contactEl);
            });

            // Refs
            const checklistContainer = document.getElementById('checklistContainer');
            const employeeSelect = document.getElementById('employeeSelect');
            const commentModal = document.getElementById('commentModal');
            const commentTextarea = document.getElementById('commentTextarea');
            const completionModal = document.getElementById('completionModal');
            
            let currentSection = 'start';
            let currentPhotos = {}; 
            let appState = {};
            const STORAGE_KEY = 'shiftChecklistState_v3';
            const OFFLINE_KEY = 'offlineReportsQueue';

            // Photo Button Template
            const photoButtonHtml = `
                <label class="cursor-pointer flex-shrink-0 ml-2">
                    <input type="file" accept="image/*" capture="environment" class="hidden photo-input">
                    <div class="photo-btn p-2 rounded-lg border border-gray-300 dark:border-slate-600 hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors h-10 w-10 flex items-center justify-center" title="Додати фото">
                        <svg class="h-6 w-6 text-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                </label>
            `;

            // --- RENDER FUNCTION ---
            const renderChecklist = (sectionId) => {
                checklistContainer.innerHTML = '';
                const isStart = sectionId === 'start';
                
                const contentWrapper = document.createElement('section');
                contentWrapper.id = `${sectionId}ShiftSection`;
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'card p-4 sm:p-6 rounded-2xl shadow-md mb-4';
                headerDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                         <h2 class="text-xl sm:text-2xl font-bold text-emerald-800">${isStart ? 'Перевірка (Початок)' : 'Перевірка (Кінець)'}</h2>
                         <button id="reset${isStart ? 'Start' : 'End'}" class="px-3 py-1 bg-orange-500 text-white text-sm font-semibold rounded-lg hover:bg-orange-600 transition-colors shadow-md">Очистити</button>
                    </div>
                    <div id="groupsContainer" class="space-y-4"></div>
                `;
                contentWrapper.appendChild(headerDiv);
                
                const groupsContainer = headerDiv.querySelector('#groupsContainer');

                checklistConfig.forEach(group => {
                    // Filter items for current section
                    const activeItems = group.items.filter(item => item.visibleOn === 'all' || item.visibleOn === sectionId);
                    
                    if (activeItems.length === 0) return;

                    const groupDiv = document.createElement('div');
                    groupDiv.innerHTML = `<h3 class="font-bold text-lg mb-2 text-emerald-700 dark:text-emerald-400">${group.title}</h3>`;
                    
                    const list = document.createElement('ul');
                    list.className = 'space-y-3';

                    activeItems.forEach(item => {
                        const uniqueId = `${sectionId}-${item.id}`; 
                        const li = document.createElement('li');
                        li.id = uniqueId;
                        li.className = 'checklist-item p-3 rounded-lg';
                        li.dataset.type = item.type;
                        
                        let controlsHtml = '';
                        if (item.type === 'binary') {
                            controlsHtml = `
                                <div class="flex gap-2 mt-2 controls-area items-center">
                                    <button class="option-btn px-3 py-2 rounded text-sm font-medium flex-1 h-10" data-val="${item.options[0]}" data-kind="good">${item.options[0]}</button>
                                    <button class="option-btn px-3 py-2 rounded text-sm font-medium flex-1 h-10" data-val="${item.options[1]}" data-kind="bad">${item.options[1]}</button>
                                    ${photoButtonHtml}
                                </div>
                            `;
                        } else if (item.type === 'input') {
                            controlsHtml = `
                                <div class="mt-2 flex items-center gap-2 controls-area">
                                    <div class="relative flex-1">
                                        <input type="text" class="p-2 rounded w-full text-center font-bold h-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-700" placeholder="---" data-input>
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-sm font-bold text-muted whitespace-nowrap">${item.unit}</span>
                                    </div>
                                    ${photoButtonHtml}
                                </div>
                            `;
                        } else if (item.type === 'dual_input') {
                            controlsHtml = `
                                <div class="mt-2 flex items-center gap-2 controls-area">
                                    <div class="flex flex-1 gap-2">
                                        <div class="relative w-1/2">
                                            <input type="text" class="p-2 rounded w-full text-center font-bold h-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-700" placeholder="${item.labels[0]}" data-input-1>
                                        </div>
                                        <div class="relative w-1/2">
                                            <input type="text" class="p-2 rounded w-full text-center font-bold h-10 border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-700" placeholder="${item.labels[1]}" data-input-2>
                                        </div>
                                    </div>
                                    ${photoButtonHtml}
                                </div>
                            `;
                        }

                        li.innerHTML = `
                            <div class="w-full">
                                <div class="flex justify-between items-start">
                                    <span class="task-text font-medium text-lg leading-tight flex-1 mr-2">${item.text}</span>
                                    <div class="flex items-center gap-1 photo-controls">
                                        <button class="comment-btn p-1 rounded-full hover:bg-gray-200 dark:hover:bg-slate-600 flex-shrink-0" title="Додати коментар">
                                            <svg class="h-5 w-5 text-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                        </button>
                                    </div>
                                </div>
                                ${controlsHtml}
                                <div class="flex items-center gap-2 mt-1">
                                    <div class="print-value text-emerald-600"></div>
                                    <img src="" class="photo-thumbnail hidden">
                                </div>
                                <div class="comment-text mt-1 hidden w-full text-sm text-gray-500 italic"></div>
                            </div>
                        `;
                        list.appendChild(li);
                    });
                    
                    groupDiv.appendChild(list);
                    groupsContainer.appendChild(groupDiv);
                });

                // Add Main Submit Button at the bottom
                const submitDiv = document.createElement('div');
                submitDiv.id = "mainSubmitSection";
                submitDiv.className = "mt-6 mb-4";
                submitDiv.innerHTML = `
                    <button id="mainSubmitBtn" class="w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-lg transition-transform transform active:scale-95 flex items-center justify-center text-lg">
                        <svg class="w-6 h-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Перевірити та відправити звіт
                    </button>
                `;
                contentWrapper.appendChild(submitDiv);

                checklistContainer.appendChild(contentWrapper);
                
                attachItemListeners();
                document.getElementById(`reset${isStart ? 'Start' : 'End'}`).addEventListener('click', () => {
                    if(confirm("Ви впевнені, що хочете очистити цю секцію?")) {
                        clearSectionData(currentSection);
                    }
                });
                document.getElementById('mainSubmitBtn').addEventListener('click', () => showCompletionModal(currentSection));
            };

            // --- IMAGE COMPRESSION & HANDLING ---
            const handlePhotoUpload = (input, item, uniqueId) => {
                if (!employeeSelect.value) { 
                    alert("Спочатку оберіть механіка!"); 
                    input.value = ''; 
                    return; 
                }
                
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.getElementById('compressionCanvas');
                            const ctx = canvas.getContext('2d');
                            const MAX_WIDTH = 800;
                            let width = img.width;
                            let height = img.height;
                            
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                            canvas.width = width;
                            canvas.height = height;
                            ctx.drawImage(img, 0, 0, width, height);
                            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                            currentPhotos[uniqueId] = dataUrl;
                            
                            const thumb = item.querySelector('.photo-thumbnail');
                            thumb.src = dataUrl;
                            thumb.classList.remove('hidden');
                            thumb.classList.add('show');
                            item.querySelector('.photo-btn').classList.add('has-photo');
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            // --- LOGIC ---
            const attachItemListeners = () => {
                const items = document.querySelectorAll('.checklist-item');
                items.forEach(item => {
                    const id = item.id;
                    const type = item.dataset.type;

                    const photoInput = item.querySelector('.photo-input');
                    if(photoInput) photoInput.addEventListener('change', () => handlePhotoUpload(photoInput, item, id));

                    item.querySelector('.comment-btn').addEventListener('click', () => openCommentModal(item));

                    if (type === 'binary') {
                        const btns = item.querySelectorAll('.option-btn');
                        btns.forEach(btn => {
                            btn.addEventListener('click', () => {
                                if (!employeeSelect.value) { alert("Оберіть механіка!"); return; }
                                btns.forEach(b => b.classList.remove('selected-good', 'selected-bad'));
                                if (btn.dataset.kind === 'good') btn.classList.add('selected-good');
                                else btn.classList.add('selected-bad');
                                
                                item.classList.add('completed');
                                item.dataset.value = btn.dataset.val;
                                item.querySelector('.print-value').textContent = `Обрано: ${btn.dataset.val}`;
                                saveState();
                                updateProgress();
                            });
                        });
                    } else if (type === 'input') {
                        const input = item.querySelector('input');
                        input.addEventListener('input', () => {
                             if (!employeeSelect.value) { input.blur(); alert("Оберіть механіка!"); return; }
                             if(input.value.trim() !== '') {
                                 item.classList.add('completed');
                                 item.dataset.value = input.value;
                                 item.querySelector('.print-value').textContent = `Значення: ${input.value}`;
                             } else {
                                 item.classList.remove('completed');
                                 delete item.dataset.value;
                                 item.querySelector('.print-value').textContent = '';
                             }
                             saveState();
                             updateProgress();
                        });
                    } else if (type === 'dual_input') {
                        const input1 = item.querySelector('[data-input-1]');
                        const input2 = item.querySelector('[data-input-2]');
                        
                        const handleDualChange = () => {
                            if (!employeeSelect.value) { input1.blur(); input2.blur(); alert("Оберіть механіка!"); return; }
                            const v1 = input1.value.trim();
                            const v2 = input2.value.trim();
                            
                            if (v1 || v2) {
                                item.classList.add('completed');
                                const label1 = input1.placeholder;
                                const label2 = input2.placeholder;
                                const displayStr = `${label1}: ${v1 || '-'} / ${label2}: ${v2 || '-'}`;
                                item.dataset.value = displayStr;
                                item.querySelector('.print-value').textContent = displayStr;
                            } else {
                                item.classList.remove('completed');
                                delete item.dataset.value;
                                item.querySelector('.print-value').textContent = '';
                            }
                            saveState();
                            updateProgress();
                        };

                        input1.addEventListener('input', handleDualChange);
                        input2.addEventListener('input', handleDualChange);
                    }
                });
            };

            // Comments
            let currentCommentItem = null;
            const openCommentModal = (item) => {
                currentCommentItem = item;
                commentTextarea.value = item.querySelector('.comment-text').textContent;
                commentModal.style.display = 'flex';
            };
            
            const saveCommentBtn = document.getElementById('saveCommentBtn');
            if(saveCommentBtn) {
                saveCommentBtn.addEventListener('click', () => {
                    if (currentCommentItem) {
                        const commentEl = currentCommentItem.querySelector('.comment-text');
                        const newComment = commentTextarea.value.trim();
                        commentEl.textContent = newComment;
                        commentEl.classList.toggle('hidden', !newComment);
                        saveState();
                    }
                    commentModal.style.display = 'none';
                });
            }

            const cancelCommentBtn = document.getElementById('cancelCommentBtn');
            if(cancelCommentBtn) {
                cancelCommentBtn.addEventListener('click', () => commentModal.style.display = 'none');
            }

            // State
            const saveState = () => {
                const state = {
                    checklist: {},
                    employee: employeeSelect.value,
                    theme: document.body.classList.contains('dark') ? 'dark' : 'light'
                };
                document.querySelectorAll('.checklist-item').forEach(item => {
                    state.checklist[item.id] = {
                        completed: item.classList.contains('completed'),
                        value: item.dataset.value || '',
                        comment: item.querySelector('.comment-text').textContent
                    };
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            };

            const loadState = () => {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    appState = JSON.parse(savedState);
                    if (appState.employee) employeeSelect.value = appState.employee;
                    if (appState.theme === 'dark') document.body.classList.add('dark');
                }
            };
            
            const restoreDOMState = () => {
                if(!appState.checklist) return;
                Object.keys(appState.checklist).forEach(id => {
                    const el = document.getElementById(id);
                    if(el) {
                        const data = appState.checklist[id];
                        if (data.completed) el.classList.add('completed');
                        if (data.value) {
                            el.dataset.value = data.value;
                            if(el.dataset.type === 'binary') {
                                const btn = Array.from(el.querySelectorAll('.option-btn')).find(b => b.dataset.val === data.value);
                                if(btn) {
                                    if(btn.dataset.kind === 'good') btn.classList.add('selected-good');
                                    else btn.classList.add('selected-bad');
                                }
                                el.querySelector('.print-value').textContent = `Обрано: ${data.value}`;
                            } else if(el.dataset.type === 'input') {
                                el.querySelector('input').value = data.value;
                                el.querySelector('.print-value').textContent = `Значення: ${data.value}`;
                            } else if (el.dataset.type === 'dual_input') {
                                // Try to parse "Label: Val / Label: Val" back to inputs
                                const parts = data.value.split(' / ');
                                if(parts.length === 2) {
                                    const v1 = parts[0].split(': ')[1];
                                    const v2 = parts[1].split(': ')[1];
                                    el.querySelector('[data-input-1]').value = v1 === '-' ? '' : v1;
                                    el.querySelector('[data-input-2]').value = v2 === '-' ? '' : v2;
                                }
                                el.querySelector('.print-value').textContent = data.value;
                            }
                        }
                        if (data.comment) {
                            const cEl = el.querySelector('.comment-text');
                            cEl.textContent = data.comment;
                            cEl.classList.remove('hidden');
                        }
                    }
                });
                updateProgress();
            };

            const updateProgress = () => {
                if(currentSection === 'contacts') return;
                const items = document.querySelectorAll(`#${currentSection}ShiftSection .checklist-item`);
                const completedCount = document.querySelectorAll(`#${currentSection}ShiftSection .checklist-item.completed`).length;
                const total = items.length;
                const percentage = total > 0 ? (completedCount / total) * 100 : 0;
                
                document.getElementById('currentProgressBar').style.width = `${percentage}%`;
                document.getElementById('currentStatus').textContent = `Залишилось завдань: ${total - completedCount}`;
            };

            const clearSectionData = (sectionId) => {
                const items = document.querySelectorAll(`#${sectionId}ShiftSection .checklist-item`);
                items.forEach(item => {
                    item.classList.remove('completed');
                    delete item.dataset.value;
                    item.querySelector('.comment-text').textContent = '';
                    item.querySelector('.comment-text').classList.add('hidden');
                    item.querySelector('.print-value').textContent = '';
                    
                    const thumb = item.querySelector('.photo-thumbnail');
                    if(thumb) { thumb.src = ''; thumb.classList.add('hidden'); }
                    const pBtn = item.querySelector('.photo-btn');
                    if(pBtn) pBtn.classList.remove('has-photo');
                    item.querySelector('.photo-input').value = '';
                    delete currentPhotos[item.id];
                    
                    if(item.dataset.type === 'binary') {
                        item.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected-good', 'selected-bad'));
                    } else if(item.dataset.type === 'input') {
                        item.querySelector('input').value = '';
                    } else if(item.dataset.type === 'dual_input') {
                        item.querySelector('[data-input-1]').value = '';
                        item.querySelector('[data-input-2]').value = '';
                    }
                });
                saveState();
                updateProgress();
            };

            // --- OFFLINE LOGIC ---
            const updateNetworkStatus = () => {
                const dot = document.getElementById('statusDot');
                const text = document.getElementById('statusText');
                const queue = JSON.parse(localStorage.getItem(OFFLINE_KEY) || '[]');
                
                if (!navigator.onLine) {
                    dot.className = 'status-dot offline';
                    text.textContent = `Офлайн (${queue.length})`;
                } else if (queue.length > 0) {
                    dot.className = 'status-dot offline'; // Red if pending items
                    text.textContent = `Черга (${queue.length})`;
                } else {
                    dot.className = 'status-dot online';
                    text.textContent = 'Онлайн';
                }
            };

            const saveReportOffline = (reportData) => {
                const queue = JSON.parse(localStorage.getItem(OFFLINE_KEY) || '[]');
                queue.push(reportData);
                localStorage.setItem(OFFLINE_KEY, JSON.stringify(queue));
                updateNetworkStatus();
                alert(`Відсутній інтернет. Звіт збережено локально! Він буде відправлений автоматично при появі мережі.`);
            };

            const processOfflineQueue = async () => {
                const queue = JSON.parse(localStorage.getItem(OFFLINE_KEY) || '[]');
                if (queue.length === 0) return;

                const statusDot = document.getElementById('statusDot');
                statusDot.className = 'status-dot syncing';
                document.getElementById('statusText').textContent = 'Синхронізація...';

                const newQueue = [];
                for (const report of queue) {
                    try {
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(report)
                        });
                        // Assume success if no error thrown
                    } catch (e) {
                        console.error('Failed to sync report', e);
                        newQueue.push(report); // Keep in queue
                    }
                }

                localStorage.setItem(OFFLINE_KEY, JSON.stringify(newQueue));
                updateNetworkStatus();
                
                if (newQueue.length === 0) {
                    alert('Всі офлайн звіти успішно відправлено!');
                }
            };

            window.addEventListener('online', () => {
                updateNetworkStatus();
                processOfflineQueue();
            });
            window.addEventListener('offline', updateNetworkStatus);
            document.getElementById('networkStatusBtn').addEventListener('click', processOfflineQueue);

            // --- Navigation & View Logic ---
            const switchView = (view) => {
                currentSection = view;
                document.getElementById('contactsSection').classList.add('hidden');
                document.getElementById('footerStatus').style.display = 'flex';
                document.getElementById('startShiftBtn').classList.remove('active');
                document.getElementById('endShiftBtn').classList.remove('active');

                if (view === 'contacts') {
                    checklistContainer.classList.add('hidden');
                    document.getElementById('contactsSection').classList.remove('hidden');
                    document.getElementById('footerStatus').style.display = 'none';
                } else {
                    checklistContainer.classList.remove('hidden');
                    renderChecklist(view);
                    restoreDOMState();
                    if(view === 'start') document.getElementById('startShiftBtn').classList.add('active');
                    else document.getElementById('endShiftBtn').classList.add('active');
                    updateProgress();
                }
            };

            // Preview and Submit
            const showCompletionModal = (section) => {
                if (!employeeSelect.value) { alert("Оберіть механіка!"); return; }
                const modal = document.getElementById('completionModal');
                
                // Generate Preview Table
                const items = Array.from(document.querySelectorAll(`#${section}ShiftSection .checklist-item`));
                let tableHtml = '<table class="preview-table w-full"><thead><tr><th>Питання</th><th>Відповідь</th></tr></thead><tbody>';
                
                items.forEach(item => {
                    const text = item.querySelector('.task-text').textContent;
                    const val = item.dataset.value || '<span class="text-red-500">Не заповнено</span>';
                    const hasPhoto = currentPhotos[item.id] ? '📷' : '';
                    tableHtml += `<tr><td>${text}</td><td>${val} ${hasPhoto}</td></tr>`;
                });
                tableHtml += '</tbody></table>';
                
                document.getElementById('previewContent').innerHTML = tableHtml;
                modal.style.display = 'flex';
                
                const btn = document.getElementById('submitReportBtn');
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', () => submitReport(section));
            };

            const submitReport = async (section) => {
                if (GOOGLE_SCRIPT_URL.includes('ВСТАВТЕ')) { alert("Налаштуйте Google Script URL"); return; }
                
                const btn = document.getElementById('submitReportBtn');
                const status = document.getElementById('submitStatus');
                btn.disabled = true;
                btn.textContent = 'Відправка...';
                status.classList.remove('hidden');
                status.textContent = 'Обробка даних...';
                status.className = 'mt-2 text-sm text-blue-600 font-bold';

                const sectionTitle = (section === 'start') ? 'Початок зміни' : 'Кінець зміни';
                const items = Array.from(document.querySelectorAll(`#${section}ShiftSection .checklist-item`));
                const total = items.length;
                const completed = items.filter(i => i.classList.contains('completed')).length;

                const now = new Date();
                const dateStr = now.toLocaleDateString('uk-UA').replace(/\./g, '-');
                const timeStr = now.toLocaleTimeString('uk-UA').replace(/:/g, '-');

                const reportItems = items.map(item => {
                    const uniqueId = item.id;
                    const itemText = item.querySelector('.task-text').textContent.trim();
                    const photoBase64 = currentPhotos[uniqueId] || null;
                    const safeName = itemText.substring(0, 20).replace(/[^a-zа-я0-9]/gi, '_');
                    const photoName = photoBase64 ? `${safeName}_${dateStr}_${timeStr}.jpg` : null;

                    return {
                        text: itemText,
                        completed: item.classList.contains('completed'),
                        value: item.dataset.value || 'Н/Д',
                        comment: item.querySelector('.comment-text').textContent.trim(),
                        photoData: photoBase64,
                        photoName: photoName
                    };
                });

                const reportData = {
                    date: new Date().toLocaleString('uk-UA'),
                    time: new Date().toLocaleTimeString('uk-UA'),
                    mechanic: employeeSelect.value,
                    shiftStage: sectionTitle,
                    summary: `Виконано ${completed} з ${total}`,
                    items: reportItems
                };

                // Check offline first
                if (!navigator.onLine) {
                    saveReportOffline(reportData);
                    // Clear form after saving offline
                    clearSectionData(section);
                    status.textContent = 'Збережено офлайн!';
                    setTimeout(() => {
                        document.getElementById('completionModal').style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Підтвердити та Відправити';
                        status.classList.add('hidden');
                    }, 1500);
                    return;
                }

                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reportData)
                    });
                    
                    // Clear form after successful send
                    clearSectionData(section);

                    status.textContent = '✅ Успішно! Звіт відправлено.';
                    status.className = 'mt-2 text-sm text-green-600 font-bold';
                    setTimeout(() => {
                        document.getElementById('completionModal').style.display = 'none';
                        btn.disabled = false;
                        btn.textContent = 'Підтвердити та Відправити';
                        status.classList.add('hidden');
                    }, 2000);
                } catch (e) {
                    // Fallback to offline save if fetch fails
                    console.error(e);
                    saveReportOffline(reportData);
                    clearSectionData(section);
                    status.textContent = 'Збережено офлайн (помилка мережі).';
                    setTimeout(() => {
                        document.getElementById('completionModal').style.display = 'none';
                        btn.disabled = false;
                    }, 2000);
                }
            };
            
            document.getElementById('footerStatus').addEventListener('click', () => {
                if(currentSection !== 'contacts') showCompletionModal(currentSection);
            });

            // Init
            const employees = ["Свінцов Михайло", "Гора Андрій", "Заміна"];
            employees.forEach(e => employeeSelect.add(new Option(e, e)));
            
            document.getElementById('themeToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark');
                saveState();
            });
            document.getElementById('printBtn').addEventListener('click', () => window.print());
            
            const closeModalBtn = document.getElementById('closeModalBtn');
            if(closeModalBtn) {
                closeModalBtn.addEventListener('click', () => completionModal.style.display = 'none');
            }
            
            document.getElementById('startShiftBtn').addEventListener('click', () => switchView('start'));
            document.getElementById('endShiftBtn').addEventListener('click', () => switchView('end'));
            document.getElementById('contactsBtnHeader').addEventListener('click', () => switchView('contacts'));

            loadState();
            updateNetworkStatus(); // Init network status
            switchView('start');
        });
    </script>
</body>
</html>
