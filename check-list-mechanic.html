<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Інтерактивний чек-лист: Механік зміни</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base Variables for Theming */
        :root {
            --bg-color: #f8fafc; /* slate-50 */
            --card-bg-color: #ffffff;
            --text-color: #1e293b; /* slate-800 */
            --text-muted-color: #64748b; /* slate-500 */
            --item-bg-color: #f1f5f9; /* slate-100 */
            --item-hover-bg-color: #e2e8f0; /* slate-200 */
            --border-color: #e2e8f0;
            --priority-border-color: #fecaca; /* red-200 */
            --header-icon-hover-bg: #e5e7eb; /* gray-200 */
        }

        .dark {
            --bg-color: #1e293b; /* slate-800 */
            --card-bg-color: #334155; /* slate-700 */
            --text-color: #f1f5f9; /* slate-100 */
            --text-muted-color: #94a3b8; /* slate-400 */
            --item-bg-color: #475569; /* slate-600 */
            --item-hover-bg-color: #64748b; /* slate-500 */
            --border-color: #475569;
            --priority-border-color: #991b1b; /* red-800 */
            --header-icon-hover-bg: #475569; /* slate-600 */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 6rem; /* Space for fixed footer */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* General Component Styling */
        .card { background-color: var(--card-bg-color); }
        .text-muted { color: var(--text-muted-color); }
        .header-icon:hover { background-color: var(--header-icon-hover-bg); }

        .checklist-item {
            background-color: var(--item-bg-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .checklist-item:hover { background-color: var(--item-hover-bg-color); }
        
        .checklist-item.completed {
            background-color: var(--item-hover-bg-color);
            color: var(--text-muted-color);
        }
        .checklist-item.completed .task-text { text-decoration: line-through; }
        .checklist-item.completed .checkbox-icon::after { content: '✔'; color: #10b981; }
        
        .priority-item { border: 1px solid var(--priority-border-color); }
        
        .nav-button.active { background-color: #059669; color: white; border-color: #059669; }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }

        .modal-overlay { background-color: rgba(0, 0, 0, 0.6); z-index: 1000; }
        .modal-content { z-index: 1001; }
        .disabled-checklist-item { pointer-events: none; opacity: 0.5; cursor: not-allowed; }
        .comment-text { font-size: 0.875rem; color: var(--text-muted-color); padding-left: 3.25rem; }

        /* Print Styles */
        @media print {
            body { padding-bottom: 0; }
            header, .mb-6.bg-white, nav, #footerStatus, .modal-overlay, .actions, button, a[href^="tel"] {
                display: none !important;
            }
            main, section, .card {
                display: block !important;
                box-shadow: none !important;
                border: none !important;
            }
            .checklist-item { page-break-inside: avoid; }
            .checklist-item.completed .checkbox-icon::after { content: '✔'; }
            .checklist-item:not(.completed) .checkbox-icon::after { content: '☐'; }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans">

    <div class="container mx-auto max-w-3xl p-4 sm:p-6 lg:p-8">
        
        <header class="relative text-center mb-6">
             <div class="absolute top-0 left-0 text-center">
                <a href="#" onclick="location.reload()" class="inline-block p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Оновити сторінку">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                </a>
                <div id="current-date" class="text-muted text-xs mt-1"></div>
            </div>

            <img src="https://foodline-production.com/wp-content/uploads/2021/10/3752781497_3752781497.webp" alt="Foodline Production Logo" class="w-24 h-auto mx-auto mb-4 rounded-lg">

            <h1 class="text-2xl sm:text-3xl font-bold">Чек-лист Механіка зміни</h1>
            <p class="text-muted">Контрольні точки для організації роботи</p>

            <div class="absolute top-0 right-0 flex space-x-2">
                 <button id="printBtn" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Друк / Зберегти в PDF">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
                </button>
                 <button id="themeToggle" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Темна/Світла тема">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                </button>
                <button id="contactsBtnHeader" class="p-2 rounded-full text-muted header-icon transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500" title="Контакти">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M12 14a4 4 0 100-8 4 4 0 000 8z" /></svg>
                </button>
            </div>
        </header>

        <div class="mb-6 card p-4 rounded-xl shadow-sm">
            <label for="employeeSelect" class="block text-sm font-bold mb-2">Прізвище та ім'я Механіка:</label>
            <select id="employeeSelect" class="block w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 card text-muted">
                <option value="">Оберіть зі списку</option>
            </select>
            <p id="employeeSelectionHint" class="text-red-500 text-xs mt-2 hidden">Будь ласка, оберіть своє ім'я, щоб розпочати роботу з чек-листом.</p>
        </div>

        <nav class="flex justify-center items-center mb-6 card p-2 rounded-xl shadow-sm">
            <button id="startShiftBtn" class="nav-button active w-1/2 text-center py-2 px-4 rounded-lg font-semibold border border-gray-300 dark:border-slate-600 focus:outline-none transition-all duration-300">Початок зміни</button>
            <button id="endShiftBtn" class="nav-button w-1/2 text-center py-2 px-4 rounded-lg font-semibold border border-gray-300 dark:border-slate-600 focus:outline-none transition-all duration-300">Кінець зміни</button>
        </nav>

        <main>
            <section id="startShiftSection">
                <div class="card p-4 sm:p-6 rounded-2xl shadow-md">
                    <div class="flex justify-between items-center mb-4">
                         <h2 class="text-xl sm:text-2xl font-bold text-emerald-800">Перевірка обладнання (Початок)</h2>
                         <button id="resetStart" class="px-3 py-1 bg-orange-500 text-white text-sm font-semibold rounded-lg hover:bg-orange-600 transition-colors shadow-md">Скинути</button>
                    </div>
                    <p class="text-muted mb-4">Повний обхід всіх систем на початку зміни.</p>
                    
                    <div class="space-y-3">
                        <!-- Group 1 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">1. Компресорне приміщення</h3>
                            <ul class="space-y-2" data-section="start">
                                <li id="start-1-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-1-2" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-1-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-1-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-1-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-1-6" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 2 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">2. Свердловини №1 та №2</h3>
                            <ul class="space-y-2" data-section="start">
                                <li id="start-2-1" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-2-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-2-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-2-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 3 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">3. Котельні №1 та №2</h3>
                            <ul class="space-y-2" data-section="start">
                                <li id="start-3-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-6" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-3-7" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 4 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">4. ХВО (Хімічне водоочищення)</h3>
                            <ul class="space-y-2" data-section="start">
                                <li id="start-4-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-3" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-6" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-4-7" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 5 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">5. Виробничі зони</h3>
                            <ul class="space-y-2" data-section="start">
                                <li id="start-5-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-5-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-5-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-5-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 6 -->
                        <div>
                             <h3 class="font-bold text-lg mb-2">6. Генератор</h3>
                             <ul class="space-y-2" data-section="start">
                                <li id="start-6-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-6-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-6-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-6-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                             </ul>
                        </div>
                        <!-- Group 7 -->
                        <div>
                             <h3 class="font-bold text-lg mb-2">7. Холодильний контейнер</h3>
                             <ul class="space-y-2" data-section="start">
                                <li id="start-7-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-7-2" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-7-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-7-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="start-7-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                             </ul>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="endShiftSection" class="hidden">
                 <div class="card p-4 sm:p-6 rounded-2xl shadow-md">
                    <div class="flex justify-between items-center mb-4">
                         <h2 class="text-xl sm:text-2xl font-bold text-sky-800">Перевірка обладнання (Кінець)</h2>
                         <button id="resetEnd" class="px-3 py-1 bg-orange-500 text-white text-sm font-semibold rounded-lg hover:bg-orange-600 transition-colors shadow-md">Скинути</button>
                    </div>
                    <p class="text-muted mb-4">Повний обхід всіх систем наприкінці зміни.</p>

                    <div class="space-y-3">
                         <!-- Group 1 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">1. Компресорне приміщення</h3>
                            <ul class="space-y-2" data-section="end">
                                <li id="end-1-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-1-2" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-1-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-1-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-1-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-1-6" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 2 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">2. Свердловини №1 та №2</h3>
                            <ul class="space-y-2" data-section="end">
                                <li id="end-2-1" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-2-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-2-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-2-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 3 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">3. Котельні №1 та №2</h3>
                            <ul class="space-y-2" data-section="end">
                                <li id="end-3-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-6" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-3-7" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 4 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">4. ХВО (Хімічне водоочищення)</h3>
                            <ul class="space-y-2" data-section="end">
                                <li id="end-4-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-3" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-6" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-4-7" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 5 -->
                        <div>
                            <h3 class="font-bold text-lg mb-2">5. Виробничі зони</h3>
                            <ul class="space-y-2" data-section="end">
                                <li id="end-5-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-5-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-5-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-5-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                            </ul>
                        </div>
                        <!-- Group 6 -->
                        <div>
                             <h3 class="font-bold text-lg mb-2">6. Генератор</h3>
                             <ul class="space-y-2" data-section="end">
                                <li id="end-6-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-6-2" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-6-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-6-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                             </ul>
                        </div>
                        <!-- Group 7 -->
                        <div>
                             <h3 class="font-bold text-lg mb-2">7. Холодильний контейнер</h3>
                             <ul class="space-y-2" data-section="end">
                                <li id="end-7-1" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-7-2" class="checklist-item priority-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-7-3" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-7-4" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                                <li id="end-7-5" class="checklist-item flex-wrap p-3 rounded-lg cursor-pointer disabled-checklist-item"></li>
                             </ul>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="contactsSection" class="hidden">
                 <div class="card p-4 sm:p-6 rounded-2xl shadow-md">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4">Контакти для оперативного зв'язку</h2>
                    <div class="space-y-4">
                        <div class="bg-red-50 dark:bg-red-900/30 border-2 border-red-200 dark:border-red-800 p-4 rounded-lg flex items-center justify-between">
                            <div>
                                <p class="font-bold">Екстрені служби</p>
                                <p class="text-red-600 dark:text-red-400">112</p>
                            </div>
                            <a href="tel:112" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                            </a>
                        </div>
                    </div>
                 </div>
            </section>
        </main>
    </div>

    <div id="footerStatus" class="fixed bottom-0 left-0 right-0 card p-4 shadow-lg flex items-center justify-between z-40">
        <div class="w-full">
            <div class="w-full bg-gray-200 dark:bg-slate-600 rounded-full h-2.5 mb-2">
                <div id="currentProgressBar" class="progress-bar-fill bg-emerald-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p id="currentStatus" class="text-sm text-muted text-right">Залишилось завдань: 0</p>
        </div>
    </div>

    <div id="completionModal" class="fixed inset-0 hidden items-center justify-center modal-overlay"></div>
    <div id="commentModal" class="fixed inset-0 hidden items-center justify-center modal-overlay"></div>

    <script>
        // --- CONFIGURATION ---
        // Вставте сюди URL вашого Google Apps Script (Web App URL)
        // Наприклад: 'https://script.google.com/macros/s/AKfycbx.../exec'
        const GOOGLE_SCRIPT_URL = 'ВСТАВТЕ_ВАШЕ_ПОСИЛАННЯ_ТУТ'; 
        // ---------------------

        document.addEventListener('DOMContentLoaded', () => {
            // Reusing text strings for both start and end
            const texts = {
                // 1. Компресорне приміщення
                '1-1': 'Перевірити температуру компресорів №1 та №2.',
                '1-2': 'Проконтролювати відсутність помилок на пультах керування компресорів.',
                '1-3': 'Вимкнути систему нічного обігріву приміщення.',
                '1-4': 'Відкрити заслінки припливно-витяжної вентиляції.',
                '1-5': 'Оглянути осушувач повітря на справність.',
                '1-6': 'Увімкнути подачу тиску на ресивери.',

                // 2. Свердловини №1 та №2
                '2-1': 'Перевірити табло клапана тиску на наявність помилок.',
                '2-2': 'Здійснити візуальний огляд цілісності трубопроводів.',
                '2-3': 'Проконтролювати роботу насосів (відсутність стороннього шуму та вібрації).',
                '2-4': 'Зафіксувати додаткові зауваження щодо стану об’єктів у журналі.',

                // 3. Котельні №1 та №2
                '3-1': 'Зняти показники манометрів тиску пари.',
                '3-2': 'Проконтролювати коректність роботи водяних насосів.',
                '3-3': 'Перевірити рівень води в ємності забору води.',
                '3-4': 'Здійснити візуальний контроль рівнемірів та оглядового скла (вода, пара).',
                '3-5': 'Оглянути стан димососа та вентиляторів топки.',
                '3-6': 'Перевірити герметичність паропроводів, засувок та вентилів.',
                '3-7': 'Провести огляд щита керування котельнею.',

                // 4. ХВО (Хімічне водоочищення)
                '4-1': 'Перевірити тиск води на вході та на виході із системи.',
                '4-2': 'Проконтролювати робочий тиск повітря.',
                '4-3': 'Переконатися у відсутності помилок під час процесу регенерації.',
                '4-4': 'Перевірити стан та рівень води в технологічних ємностях.',
                '4-5': 'Оглянути цілісність трубопроводів та з\'єднань.',
                '4-6': 'Перевірити стан автоматів та наявність напруги на щиті керування.',
                '4-7': 'Проконтролювати роботу підвищувальних насосів (тиск та напруга).',

                // 5. Виробничі зони
                '5-1': 'Перевірити справність робочого освітлення.',
                '5-2': 'Оглянути стан трубопроводів та конденсатовідвідників у слюсарній майстерні.',
                '5-3': 'Увімкнути загальну систему вентиляції на початку зміни.',
                '5-4': 'Виміряти та зафіксувати показники напруги в мережі (за потреби).',

                // 6. Генератор
                '6-1': 'Провести зовнішній візуальний огляд агрегату.',
                '6-2': 'Переконатися у відсутності сторонніх шумів під час роботи.',
                '6-3': 'Перевірити рівень вібрації корпусу та вузлів.',
                '6-4': 'Зняти поточні показники з інформаційного табло.',

                // 7. Холодильний контейнер
                '7-1': 'Зіставити поточну температуру всередині з установленим режимом.',
                '7-2': 'Перевірити контролер на наявність аварійних кодів або помилок.',
                '7-3': 'Оглянути ущільнювачі дверей на цілісність та відсутність обмерзання.',
                '7-4': 'Проконтролювати роботу вентиляторів (відсутність звуків/вібрацій).',
                '7-5': 'Перевірити щільність закриття клапанів та прохідність дренажної системи.'
            };

            const checklistData = {};
            // Populate both start and end keys with the same text
            Object.keys(texts).forEach(key => {
                checklistData[`start-${key}`] = texts[key];
                checklistData[`end-${key}`] = texts[key];
            });

            const contactsData = [
                { name: 'Диндар Анастасія', phone: '066-313-31-75', tel: '+380663133175' },
                { name: 'Бузницький Юрій', phone: '050-446-79-73', tel: '+380504467973' },
                { name: 'Галагін Евгеній', phone: '066-217-48-25', tel: '+380662174825' },
                { name: 'Матвеєва Олена', phone: '050-334-02-67', tel: '+380503340267' },
            ];
            
            // Populate checklist items
            Object.keys(checklistData).forEach(id => {
                const itemEl = document.getElementById(id);
                if(itemEl) {
                    itemEl.innerHTML = `
                        <div class="flex items-center w-full">
                            <span class="checkbox-icon w-6 h-6 mr-3 border-2 border-gray-300 dark:border-slate-500 rounded-md flex items-center justify-center text-lg font-bold"></span>
                            <span class="task-text flex-1">${checklistData[id]}</span>
                            <div class="actions ml-auto flex items-center">
                                <button class="comment-btn p-1 rounded-full hover:bg-gray-200 dark:hover:bg-slate-600" title="Додати коментар">
                                    <svg class="h-5 w-5 text-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="comment-text mt-1 hidden w-full"></div>
                    `;
                }
            });

            // Populate contacts
            const contactsContainer = document.querySelector('#contactsSection .space-y-4');
            contactsData.forEach(contact => {
                const contactEl = document.createElement('div');
                contactEl.className = 'bg-gray-50 dark:bg-slate-600 p-4 rounded-lg flex items-center justify-between';
                contactEl.innerHTML = `
                    <div>
                        <p class="font-bold">${contact.name}</p>
                        <p class="text-muted">${contact.phone}</p>
                    </div>
                    <a href="tel:${contact.tel}" class="bg-green-500 hover:bg-green-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    </a>`;
                contactsContainer.appendChild(contactEl);
            });

            // Populate Modals
            document.getElementById('completionModal').innerHTML = `
                <div class="card p-6 rounded-2xl shadow-xl max-w-sm w-full text-center modal-content">
                    <h3 id="modalMessage" class="text-xl font-bold mb-4"></h3>
                    <button id="closeModalBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Закрити</button>
                    <button id="submitReportBtn" class="block w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-colors">Відправити звіт (Онлайн)</button>
                    <div id="submitStatus" class="mt-2 text-sm hidden"></div>
                </div>`;

            document.getElementById('commentModal').innerHTML = `
                <div class="card p-6 rounded-2xl shadow-xl max-w-sm w-full text-center modal-content">
                    <h3 class="text-xl font-bold mb-4">Ваш коментар</h3>
                    <textarea id="commentTextarea" class="w-full p-2 border rounded-lg card text-muted" rows="4"></textarea>
                    <div class="mt-4 flex justify-end space-x-2">
                         <button id="cancelCommentBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Скасувати</button>
                         <button id="saveCommentBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Зберегти</button>
                    </div>
                </div>`;
            
            // Element Refs
            const allChecklistItems = document.querySelectorAll('.checklist-item');
            const employeeSelect = document.getElementById('employeeSelect');
            let appState = {};
            const STORAGE_KEY = 'shiftChecklistState';

            // --- State Management ---
            const saveState = () => {
                const state = {
                    checklist: {},
                    employee: employeeSelect.value,
                    theme: document.body.classList.contains('dark') ? 'dark' : 'light'
                };
                allChecklistItems.forEach(item => {
                    state.checklist[item.id] = {
                        completed: item.classList.contains('completed'),
                        comment: item.querySelector('.comment-text').textContent
                    };
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            };

            const loadState = () => {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    appState = JSON.parse(savedState);

                    // Restore checklist items
                    if (appState.checklist) {
                        allChecklistItems.forEach(item => {
                            const itemState = appState.checklist[item.id];
                            if (itemState) {
                                if (itemState.completed) item.classList.add('completed');
                                if (itemState.comment) {
                                    const commentEl = item.querySelector('.comment-text');
                                    commentEl.textContent = itemState.comment;
                                    commentEl.classList.remove('hidden');
                                }
                            }
                        });
                    }

                    // Restore employee
                    if (appState.employee) {
                        employeeSelect.value = appState.employee;
                        if(employeeSelect.value) {
                             document.querySelectorAll('.checklist-item').forEach(i => i.classList.remove('disabled-checklist-item'));
                             document.getElementById('employeeSelectionHint').classList.add('hidden');
                        }
                    }

                    // Restore theme
                    if (appState.theme === 'dark') {
                        document.body.classList.add('dark');
                    }
                }
            };
            
            // --- UI & Event Listeners ---
            const commentModal = document.getElementById('commentModal');
            const commentTextarea = document.getElementById('commentTextarea');
            let currentCommentItem = null;

            allChecklistItems.forEach(item => {
                // Click on the item itself (toggle completed)
                item.addEventListener('click', (event) => {
                      if (employeeSelect.value && !event.target.closest('.actions')) {
                        item.classList.toggle('completed');
                        saveState();
                        updateProgress();
                    } else if (!employeeSelect.value) {
                        document.getElementById('employeeSelectionHint').classList.remove('hidden');
                    }
                });

                // Click on comment button
                item.querySelector('.comment-btn').addEventListener('click', () => {
                    currentCommentItem = item;
                    commentTextarea.value = item.querySelector('.comment-text').textContent;
                    commentModal.style.display = 'flex';
                });
            });

            document.getElementById('saveCommentBtn').addEventListener('click', () => {
                if (currentCommentItem) {
                    const commentEl = currentCommentItem.querySelector('.comment-text');
                    const newComment = commentTextarea.value.trim();
                    commentEl.textContent = newComment;
                    commentEl.classList.toggle('hidden', !newComment);
                    saveState();
                }
                commentModal.style.display = 'none';
            });
            
            document.getElementById('cancelCommentBtn').addEventListener('click', () => {
                commentModal.style.display = 'none';
            });
            
            const completionModal = document.getElementById('completionModal');
            
            // --- NEW: SEND TO GOOGLE SHEETS LOGIC ---
            const submitReportBtn = document.getElementById('submitReportBtn');
            const submitStatus = document.getElementById('submitStatus');

            const submitReport = async (section) => {
                if (!employeeSelect.value) {
                    alert('Будь ласка, оберіть своє ім\'я перед відправкою звіту.');
                    return;
                }
                if (GOOGLE_SCRIPT_URL.includes('ВСТАВТЕ_ВАШЕ_ПОСИЛАННЯ_ТУТ')) {
                    alert('Помилка: Не налаштовано посилання на Google Script. Зверніться до адміністратора.');
                    return;
                }

                // UI Loading State
                submitReportBtn.disabled = true;
                submitReportBtn.textContent = 'Відправка даних...';
                submitStatus.classList.remove('hidden');
                submitStatus.textContent = 'З\'єднання з сервером...';
                submitStatus.className = 'mt-2 text-sm text-blue-600';

                const sectionTitle = (section === 'start') ? 'Початок зміни' : 'Кінець зміни';
                const items = document.querySelectorAll(`#${section}ShiftSection .checklist-item`);
                
                // Calculate summary
                const totalItems = items.length;
                const completedItems = document.querySelectorAll(`#${section}ShiftSection .checklist-item.completed`).length;
                const summaryText = `Виконано ${completedItems} з ${totalItems}`;

                // Collect Data Object
                const reportData = {
                    date: new Date().toLocaleString('uk-UA'),
                    time: new Date().toLocaleTimeString('uk-UA'),
                    mechanic: employeeSelect.value,
                    shiftStage: sectionTitle,
                    summary: summaryText,
                    comments: '', // General comments if needed
                    items: []
                };

                items.forEach((item) => {
                    reportData.items.push({
                        text: item.querySelector('.task-text').textContent.trim(),
                        completed: item.classList.contains('completed'),
                        comment: item.querySelector('.comment-text').textContent.trim()
                    });
                });

                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Important for Google Apps Script simple triggers
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(reportData)
                    });

                    // Success UI
                    submitStatus.textContent = '✅ Звіт успішно відправлено!';
                    submitStatus.className = 'mt-2 text-sm text-green-600 font-bold';
                    submitReportBtn.textContent = 'Відправлено';
                    
                    setTimeout(() => {
                        completionModal.style.display = 'none';
                        submitReportBtn.disabled = false;
                        submitReportBtn.textContent = 'Відправити звіт (Онлайн)';
                        submitStatus.classList.add('hidden');
                    }, 3000);

                } catch (error) {
                    console.error('Error:', error);
                    submitStatus.textContent = '❌ Помилка при відправці. Перевірте інтернет.';
                    submitStatus.className = 'mt-2 text-sm text-red-600 font-bold';
                    submitReportBtn.disabled = false;
                    submitReportBtn.textContent = 'Спробувати ще раз';
                }
            };

            const showCompletionModal = (section) => {
                const modalMessage = document.getElementById('modalMessage');
                
                let message = '';
                if (section === 'start') {
                    message = "Підготовка завершена. Вдалої зміни!";
                } else {
                    message = "Зміна завершена. Дякуємо за роботу!";
                }
                modalMessage.textContent = message;
                completionModal.style.display = 'flex';

                // Rebind the click handler to the current section
                submitReportBtn.onclick = () => submitReport(section);
            };
            
            // Other event listeners (navigation, reset, etc.)
            const startShiftBtn = document.getElementById('startShiftBtn');
            const endShiftBtn = document.getElementById('endShiftBtn');
            const contactsBtn = document.getElementById('contactsBtnHeader');
            const startShiftSection = document.getElementById('startShiftSection');
            const endShiftSection = document.getElementById('endShiftSection');
            const contactsSection = document.getElementById('contactsSection');
            const footerStatus = document.getElementById('footerStatus');
            const currentProgressBar = document.getElementById('currentProgressBar');
            const currentStatus = document.getElementById('currentStatus');
            const resetStartBtn = document.getElementById('resetStart');
            const resetEndBtn = document.getElementById('resetEnd');
            const themeToggle = document.getElementById('themeToggle');
            const printBtn = document.getElementById('printBtn');
            const employeeSelectionHint = document.getElementById('employeeSelectionHint');
            
            const closeModalBtn = document.getElementById('closeModalBtn');
            
            let currentSection = 'start';

            const employees = ["Свінцов Михайло", "Гора Андрій", "Заміна"];
            employees.forEach(e => employeeSelect.add(new Option(e, e)));

            employeeSelect.addEventListener('change', () => {
                if (employeeSelect.value) {
                    document.querySelectorAll('.checklist-item').forEach(i => i.classList.remove('disabled-checklist-item'));
                    employeeSelectionHint.classList.add('hidden');
                } else {
                    document.querySelectorAll('.checklist-item').forEach(i => i.classList.add('disabled-checklist-item'));
                }
                saveState();
            });

            const switchView = (view) => {
                currentSection = view;
                [startShiftSection, endShiftSection, contactsSection].forEach(s => s.classList.add('hidden'));
                [startShiftBtn, endShiftBtn].forEach(b => b.classList.remove('active'));
                
                footerStatus.style.display = 'flex';

                if (view === 'start') {
                    startShiftSection.classList.remove('hidden');
                    startShiftBtn.classList.add('active');
                } else if (view === 'end') {
                    endShiftSection.classList.remove('hidden');
                    endShiftBtn.classList.add('active');
                } else if (view === 'contacts') {
                    contactsSection.classList.remove('hidden');
                    footerStatus.style.display = 'none';
                }
                updateProgress();
            };

            const updateProgress = () => {
                if (currentSection === 'contacts') return;
                const items = document.querySelectorAll(`#${currentSection}ShiftSection .checklist-item`);
                const completedItems = document.querySelectorAll(`#${currentSection}ShiftSection .checklist-item.completed`).length;
                const total = items.length;
                const percentage = total > 0 ? (completedItems / total) * 100 : 0;
                
                currentProgressBar.style.width = `${percentage}%`;
                if(total > 0 && completedItems === total) {
                      currentStatus.textContent = 'Чудова робота! Всі завдання виконано.';
                      showCompletionModal(currentSection);
                } else {
                      currentStatus.textContent = `Залишилось завдань: ${total - completedItems}`;
                }
            };
            
            resetStartBtn.addEventListener('click', () => {
                 document.querySelectorAll('#startShiftSection .checklist-item').forEach(item => {
                    item.classList.remove('completed');
                    const commentEl = item.querySelector('.comment-text');
                    commentEl.textContent = '';
                    commentEl.classList.add('hidden');
                 });
                 saveState();
                 updateProgress();
            });

            resetEndBtn.addEventListener('click', () => {
                document.querySelectorAll('#endShiftSection .checklist-item').forEach(item => {
                    item.classList.remove('completed');
                    const commentEl = item.querySelector('.comment-text');
                    commentEl.textContent = '';
                    commentEl.classList.add('hidden');
                });
                saveState();
                updateProgress();
            });

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                saveState();
            });
            
            printBtn.addEventListener('click', () => window.print());

            startShiftBtn.addEventListener('click', () => switchView('start'));
            endShiftBtn.addEventListener('click', () => switchView('end'));
            contactsBtn.addEventListener('click', () => switchView('contacts'));
            closeModalBtn.addEventListener('click', () => completionModal.style.display = 'none');

            // --- Initial Load ---
            const displayDate = () => {
                const dateElement = document.getElementById('current-date');
                if (dateElement) {
                    const now = new Date();
                    const options = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
                    const formattedDate = new Intl.DateTimeFormat('uk-UA', options).format(now);
                    dateElement.textContent = formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
                }
            };

            loadState();
            displayDate();
            const hash = window.location.hash;
            if (hash === '#contacts') {
                switchView('contacts');
            } else {
                switchView('start');
            }
        });
    </script>

</body>
</html>
